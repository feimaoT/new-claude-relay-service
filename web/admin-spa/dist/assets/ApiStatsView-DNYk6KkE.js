import{aP as Ge,r as T,c as L,aY as ge,x as r,y as a,z as e,O as b,L as v,P as n,u as t,C as M,K as ve,aW as He,aa as Ie,f as Ue,aq as Me,Y as Ce,Q as X,ac as ae,B as ke,R as ee,q as We,o as Pe,V as ze,I as pe,aV as Ee,a5 as Re,aX as Je,J as Te,T as Ye,av as Qe,al as Xe}from"./vue-vendor-DV7DYXbz.js";import{bk as Ne,bl as Oe,bm as _e,b6 as Ze,bn as et,bo as tt,bp as st,_ as ue,f as O,T as Ve,c as at,aM as rt,aT as lt,a as nt,bq as ot,s as Se,br as it,bs as dt}from"./index-BRxAk06h.js";import{L as ut}from"./LogoTitle-BMjGXdyS.js";import{T as ct}from"./ThemeToggle-CORLk9IF.js";import"./vendor-Dr8jvgFu.js";import{_ as mt}from"./WindowCountdown-Cz478C_V.js";import{T as gt}from"./TutorialView-BTSV4Fed.js";import"./element-plus-BSjV1f9S.js";const xe=Ge("apistats",()=>{const U=T(""),A=T(null),o=T(!1),_=T(!1),g=T(!0),p=T(""),w=T("daily"),k=T(null),I=T([]),R=T([]),$=T([]),u=T([]),x=T(null),f=T(null),c=T(null),l=T({siteName:"",siteIcon:"",siteIconData:""}),C=T(!1),P=T([]),D=T([]),E=T(null),F=T([]),Q=T([]),W=T(null),J=T({}),se=L(()=>{const y={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return C.value&&E.value?w.value==="daily"?E.value.dailyUsage||y:w.value==="monthly"?E.value.monthlyUsage||y:E.value.alltimeUsage||y:w.value==="daily"?x.value||y:w.value==="monthly"?f.value||y:c.value||y}),ie=L(()=>{if(!k.value||!se.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const y=se.value,S=k.value.limits;return{tokenUsage:S.tokenLimit>0?Math.min(y.allTokens/S.tokenLimit*100,100):0,costUsage:S.dailyCostLimit>0?Math.min(y.cost/S.dailyCostLimit*100,100):0,requestUsage:S.rateLimitRequests>0?Math.min(y.requests/S.rateLimitRequests*100,100):0}});async function de(){if(C.value)return Y();const y=U.value.trim();if(!y){p.value="请输入 API Key";return}if(y.length<10||y.length>512){p.value="API Key 格式无效：长度应在 10-512 个字符之间";return}o.value=!0,p.value="",k.value=null,I.value=[],A.value=null;try{const S=await Ne(y);if(S.success){A.value=S.data.id;const j=await Oe(A.value);if(j.success)k.value=j.data,J.value=j.data.serviceRates||{},await te(),p.value="",ce(),ye();else throw new Error(j.message||"查询失败")}else throw new Error(S.message||"获取 API Key ID 失败")}catch(S){console.error("Query stats error:",S),p.value=S.message||"查询统计数据失败，请检查您的 API Key 是否正确",k.value=null,I.value=[],A.value=null}finally{o.value=!1}}async function te(){A.value&&(await Promise.all([V("daily"),V("monthly")]),await Z())}async function Z(){if(A.value){_.value=!0;try{const[y,S,j]=await Promise.all([_e(A.value,"daily"),_e(A.value,"monthly"),_e(A.value,"alltime")]);R.value=y.success?y.data||[]:[],$.value=S.success?S.data||[]:[],u.value=j.success?j.data||[]:[],I.value=R.value}catch(y){console.error("Load all model stats error:",y),R.value=[],$.value=[],u.value=[],I.value=[]}finally{_.value=!1}}}async function V(y){try{const S=await _e(A.value,y);if(S.success){const j=S.data||[],B={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};j.forEach(G=>{var oe;B.requests+=G.requests||0,B.inputTokens+=G.inputTokens||0,B.outputTokens+=G.outputTokens||0,B.cacheCreateTokens+=G.cacheCreateTokens||0,B.cacheReadTokens+=G.cacheReadTokens||0,B.allTokens+=G.allTokens||0,B.cost+=((oe=G.costs)==null?void 0:oe.total)||0}),B.formattedCost=z(B.cost),y==="daily"?x.value=B:y==="monthly"?f.value=B:y==="alltime"&&(c.value=B)}else console.warn(`Failed to load ${y} stats:`,S.message)}catch(S){console.error(`Load ${y} stats error:`,S)}}async function i(y="daily"){if(A.value){_.value=!0;try{const S=await _e(A.value,y);if(S.success)I.value=S.data||[];else throw new Error(S.message||"加载模型统计失败")}catch(S){console.error("Load model stats error:",S),I.value=[]}finally{_.value=!1}}}async function s(y){if(!(w.value===y||_.value)){if(w.value=y,C.value&&D.value.length>0){await le(y);return}(y==="daily"&&!x.value||y==="monthly"&&!f.value||y==="alltime"&&!c.value)&&await V(y),await i(y)}}async function m(){var y,S;if(A.value){o.value=!0,p.value="",k.value=null,I.value=[];try{const j=await Oe(A.value);if(j.success)k.value=j.data,J.value=j.data.serviceRates||{},console.log("API Stats - Full response:",j.data),console.log("API Stats - limits data:",j.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(y=j.data.limits)==null?void 0:y.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(S=j.data.limits)==null?void 0:S.weeklyOpusCost),await te(),p.value="";else throw new Error(j.message||"查询失败")}catch(j){console.error("Load stats with apiId error:",j),p.value=j.message||"查询统计数据失败",k.value=null,I.value=[]}finally{o.value=!1}}}async function K(){g.value=!0;try{const y=await Ze();y&&y.success&&y.data&&(l.value={...l.value,...y.data})}catch(y){console.error("Error loading OEM settings:",y),l.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{g.value=!1}}async function N(){try{const y=await et();y&&y.success&&y.data&&(W.value=y.data)}catch(y){console.error("Error loading service rates:",y),W.value=null}}function z(y){return typeof y!="number"||y===0?"$0.000000":y>=1?"$"+y.toFixed(2):y>=.01?"$"+y.toFixed(4):"$"+y.toFixed(6)}function ce(){if(A.value){const y=new URL(window.location);y.searchParams.set("apiId",A.value),window.history.pushState({},"",y)}}function ye(){U.value&&localStorage.setItem("lastApiKey",U.value)}function re(){return localStorage.getItem("lastApiKey")}async function Y(){const y=fe();if(y.length===0){p.value="请输入至少一个有效的 API Key";return}o.value=!0,p.value="",E.value=null,F.value=[],Q.value=[],I.value=[],P.value=y,D.value=[],J.value={};try{const S=await Promise.allSettled(y.map(oe=>Ne(oe))),j=[],B=[];if(S.forEach((oe,$e)=>{oe.status==="fulfilled"&&oe.value.success?(j.push(oe.value.data.id),B.push(y[$e])):Q.value.push(y[$e])}),j.length===0)throw new Error("所有 API Key 都无效");D.value=j,P.value=B;const G=await tt(j);if(G.success)E.value=G.data.aggregated,F.value=G.data.individual,k.value=G.data.aggregated,x.value=G.data.aggregated.dailyUsage||null,f.value=G.data.aggregated.monthlyUsage||null,await le(w.value),me();else throw new Error(G.message||"批量查询失败")}catch(S){console.error("Batch query error:",S),p.value=S.message||"批量查询统计数据失败",E.value=null,F.value=[]}finally{o.value=!1}}async function le(y="daily"){if(D.value.length!==0){_.value=!0;try{const S=await st(D.value,y);if(S.success)I.value=S.data||[];else throw new Error(S.message||"加载批量模型统计失败")}catch(S){console.error("Load batch model stats error:",S),I.value=[]}finally{_.value=!1}}}function fe(){if(!U.value)return[];const y=U.value.split(/[,\n]+/).map(j=>j.trim()).filter(j=>j.length>=10&&j.length<=512);return[...new Set(y)].slice(0,30)}function me(){if(D.value.length>0){const y=new URL(window.location);y.searchParams.set("apiIds",D.value.join(",")),y.searchParams.set("batch","true"),window.history.pushState({},"",y)}}function be(){U.value=""}function we(){k.value=null,I.value=[],R.value=[],$.value=[],u.value=[],x.value=null,f.value=null,c.value=null,p.value="",w.value="daily",A.value=null,J.value={},P.value=[],D.value=[],E.value=null,F.value=[],Q.value=[]}function he(){U.value="",C.value=!1,we()}return{apiKey:U,apiId:A,loading:o,modelStatsLoading:_,oemLoading:g,error:p,statsPeriod:w,statsData:k,modelStats:I,dailyModelStats:R,monthlyModelStats:$,alltimeModelStats:u,dailyStats:x,monthlyStats:f,alltimeStats:c,oemSettings:l,multiKeyMode:C,apiKeys:P,apiIds:D,aggregatedStats:E,individualStats:F,invalidKeys:Q,serviceRates:W,keyServiceRates:J,currentPeriodData:se,usagePercentages:ie,queryStats:de,queryBatchStats:Y,loadAllPeriodStats:te,loadAllModelStats:Z,loadPeriodStats:V,loadModelStats:i,loadBatchModelStats:le,switchPeriod:s,loadStatsWithApiId:m,loadOemSettings:K,loadServiceRates:N,loadApiKeyFromStorage:re,clearData:we,clearInput:be,reset:he}}),xt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},yt={class:"mx-auto max-w-4xl"},ft={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},pt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},vt={class:"button-group flex items-center gap-2"},bt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},kt={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},ht={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},_t={class:"lg:col-span-3"},wt={key:0,class:"relative"},$t=["disabled","type"],Ct={key:1,class:"relative"},Tt=["disabled"],St={class:"lg:col-span-1"},At=["disabled"],Kt={key:0,class:"fas fa-spinner loading-spinner"},It={key:1,class:"fas fa-search"},Pt={class:"security-notice mt-4"},Mt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Rt={__name:"ApiKeyInput",setup(U){const A=xe(),{apiKey:o,loading:_,multiKeyMode:g}=ge(A),{queryStats:p,clearInput:w}=A,k=T(!1),I=L(()=>{if(!g.value||!o.value)return[];const $=o.value.split(/[,\n]+/).map(x=>x.trim()).filter(x=>x.length>0);return[...new Set($)].slice(0,30)}),R=L(()=>g.value?I.value.length>0:o.value&&o.value.trim().length>0);return($,u)=>(a(),r("div",xt,[u[16]||(u[16]=e("div",{class:"wide-card-title mb-6"},[e("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[e("i",{class:"fas fa-chart-line mr-3"}),b(" 使用统计查询 ")]),e("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),e("div",yt,[e("div",ft,[e("label",pt,[u[9]||(u[9]=e("i",{class:"fas fa-key mr-2"},null,-1)),b(" "+n(t(g)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),e("div",vt,[e("div",bt,[e("button",{class:M(["mode-switch-btn",{active:!t(g)}]),title:"单一模式",onClick:u[0]||(u[0]=x=>g.value=!1)},u[10]||(u[10]=[e("i",{class:"fas fa-key"},null,-1),e("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),e("button",{class:M(["mode-switch-btn",{active:t(g)}]),title:"聚合模式",onClick:u[1]||(u[1]=x=>g.value=!0)},[u[11]||(u[11]=e("i",{class:"fas fa-layer-group"},null,-1)),u[12]||(u[12]=e("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),t(g)&&I.value.length>0?(a(),r("span",kt,n(I.value.length),1)):v("",!0)],2)])])]),e("div",ht,[e("div",_t,[t(g)?(a(),r("div",Ct,[ve(e("textarea",{"onUpdate:modelValue":u[5]||(u[5]=x=>Ue(o)?o.value=x:null),class:"wide-card-input w-full resize-y",disabled:t(_),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:u[6]||(u[6]=Ie(Ce((...x)=>t(p)&&t(p)(...x),["ctrl"]),["enter"]))},null,40,Tt),[[Me,t(o)]]),t(o)&&!t(_)?(a(),r("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:u[7]||(u[7]=(...x)=>t(w)&&t(w)(...x))},u[13]||(u[13]=[e("i",{class:"fas fa-times-circle"},null,-1)]))):v("",!0)])):(a(),r("div",wt,[ve(e("input",{"onUpdate:modelValue":u[2]||(u[2]=x=>Ue(o)?o.value=x:null),class:"wide-card-input w-full pr-10",disabled:t(_),placeholder:"请输入您的 API Key (cr_...)",type:k.value?"text":"password",onKeyup:u[3]||(u[3]=Ie((...x)=>t(p)&&t(p)(...x),["enter"]))},null,40,$t),[[He,t(o)]]),e("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",type:"button",onClick:u[4]||(u[4]=x=>k.value=!k.value)},[e("i",{class:M(k.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]))]),e("div",St,[e("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:t(_)||!R.value,onClick:u[8]||(u[8]=(...x)=>t(p)&&t(p)(...x))},[t(_)?(a(),r("i",Kt)):(a(),r("i",It)),b(" "+n(t(_)?"查询中...":"查询统计"),1)],8,At)])]),e("div",Pt,[u[14]||(u[14]=e("i",{class:"fas fa-shield-alt mr-2"},null,-1)),b(" "+n(t(g)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),t(g)?(a(),r("div",Mt,u[15]||(u[15]=[e("i",{class:"fas fa-lightbulb mr-2"},null,-1),e("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):v("",!0)])]))}},Lt=ue(Rt,[["__scopeId","data-v-411fd161"]]),jt={class:"space-y-4 sm:space-y-6 md:space-y-8"},Dt={class:"grid grid-cols-1 items-stretch gap-3 sm:gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},qt={class:"card-section"},Ut={class:"section-header"},Et={class:"header-title"},Nt={key:0,class:"info-grid"},Ot={class:"info-item"},Ft={class:"info-value"},Wt={class:"info-item"},zt={class:"info-value text-green-600 dark:text-emerald-400"},Vt={key:0,class:"info-item"},Bt={class:"info-value text-red-500 dark:text-red-400"},Gt={class:"info-item"},Ht={class:"info-value"},Jt={class:"info-item"},Yt={class:"info-value"},Qt={class:"info-item"},Xt={class:"info-value text-indigo-600 dark:text-indigo-300"},Zt={key:1,class:"info-item xl:col-span-2"},es={class:"space-y-2"},ts={class:"truncate"},ss={class:"font-semibold"},as={key:1,class:"info-grid"},rs={class:"info-value flex items-center gap-1 break-all"},ls={class:"info-item"},ns={class:"info-item"},os={class:"info-value"},is={key:0,class:"info-item xl:col-span-2"},ds={class:"flex flex-wrap gap-2"},us={class:"info-item"},cs={class:"info-value break-all"},ms={class:"info-item xl:col-span-2"},gs={class:"info-value"},xs={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},ys={key:0,class:"text-red-500 dark:text-red-400"},fs={key:1,class:"text-orange-500 dark:text-orange-400"},ps={key:2},vs={key:2,class:"text-gray-400 dark:text-gray-500"},bs={class:"card-section"},ks={class:"section-header"},hs={class:"header-tag"},_s={class:"metric-grid"},ws={class:"metric-card"},$s={class:"metric-value text-green-600 dark:text-emerald-300"},Cs={class:"metric-label"},Ts={class:"metric-card"},Ss={class:"metric-value text-blue-600 dark:text-sky-300"},As={class:"metric-label"},Ks={class:"metric-card"},Is={class:"metric-value text-purple-600 dark:text-violet-300"},Ps={class:"metric-label"},Ms={class:"metric-card"},Rs={class:"metric-value text-amber-500 dark:text-amber-300"},Ls={class:"metric-label"},js={key:0,class:"card-section"},Ds={class:"flex items-center justify-between gap-3"},qs={class:"flex items-center gap-3"},Us={class:"account-name"},Es={class:"account-sub"},Ns={key:0,class:"mt-3 space-y-2"},Os={class:"progress-row"},Fs={class:"progress-track"},Ws={class:"progress-value"},zs={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},Vs={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},Bs={key:1,class:"mt-3"},Gs={key:0,class:"space-y-2"},Hs={class:"quota-header"},Js={class:"quota-percent"},Ys={class:"progress-track"},Qs={class:"quota-foot"},Xs={key:1,class:"rounded-xl bg-gray-100 px-3 py-2 text-xs text-gray-500 dark:bg-gray-800 dark:text-gray-300"},Zs={__name:"StatsOverview",setup(U){const A=xe(),{statsData:o,statsPeriod:_,currentPeriodData:g,multiKeyMode:p,aggregatedStats:w,individualStats:k,invalidKeys:I}=ge(A),R=L(()=>!k.value||k.value.length===0?[]:[...k.value].sort((i,s)=>{var m,K;return(((m=s.usage)==null?void 0:m.allTokens)||0)-(((K=i.usage)==null?void 0:K.allTokens)||0)}).slice(0,3)),$=L(()=>{var i;return((i=o.value)==null?void 0:i.serviceRates)&&Object.keys(o.value.serviceRates).length>0}),u=i=>{var m;return!w.value||!w.value.usage.allTokens?0:((((m=i.usage)==null?void 0:m.allTokens)||0)/w.value.usage.allTokens*100).toFixed(1)},x=i=>i?new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",f=i=>i?new Date(i)<new Date:!1,c=i=>{if(!i)return!1;const K=(new Date(i)-new Date)/(1e3*60*60*24);return K>0&&K<=7},l=i=>{const s={claude:"Claude",gemini:"Gemini",codex:"Codex",droid:"Droid",bedrock:"Bedrock",azure:"Azure",ccr:"CCR"};if(!i)return"全部服务";let m=i;if(typeof i=="string"){if(i==="all"||i==="[]")return"全部服务";try{m=JSON.parse(i)}catch{return s[i]||i}}return Array.isArray(m)&&m.length===0?"全部服务":Array.isArray(m)?m.map(K=>s[K]||K).join(", "):s[i]||i},C=L(()=>{var m,K;const i=(K=(m=o.value)==null?void 0:m.accounts)==null?void 0:K.details;if(!i)return[];const s=[];return i.claude&&i.claude.accountType==="dedicated"&&s.push({key:"claude",...i.claude}),i.openai&&i.openai.accountType==="dedicated"&&s.push({key:"openai",...i.openai}),s}),P=L(()=>{const i=C.value.length;return i<=1?"md:grid-cols-1 lg:grid-cols-1":i===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),D=i=>i?i.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",E=i=>{if(!i||i<=0)return"";const s=Math.floor(i),m=Math.floor(s/1440),K=Math.floor(s%1440/60),N=s%60;return m>0?K>0?`${m}天${K}小时`:`${m}天`:K>0?N>0?`${K}小时${N}分钟`:`${K}小时`:`${N}分钟`},F=i=>{if(!i)return{text:"状态未知",class:"text-gray-400"};if(i.isRateLimited){const s=E(i.minutesRemaining);return{text:`限流中${s?` · 剩余约 ${s}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},Q=(i,s)=>{if(!i||!s)return"暂无时间窗口信息";const m=new Date(i),K=new Date(s),N=z=>`${`${z.getHours()}`.padStart(2,"0")}:${`${z.getMinutes()}`.padStart(2,"0")}`;return`${N(m)} - ${N(K)}`},W=i=>{if(!i||i<=0)return"";const s=Math.floor(i/60),m=i%60;return s>0?`${s}小时${m}分钟`:`${m}分钟`},J=(i,s)=>{var K;if(!i)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((K=s==null?void 0:s.rateLimitStatus)!=null&&K.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const m=String(i).toLowerCase();return m==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":m==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},se=i=>{if(!i)return null;const s=typeof i.usedPercent=="number"&&!Number.isNaN(i.usedPercent)?i.usedPercent:null,m=typeof i.resetAfterSeconds=="number"&&!Number.isNaN(i.resetAfterSeconds)?i.resetAfterSeconds:null,K=typeof i.remainingSeconds=="number"?i.remainingSeconds:null,N=i.resetAt?Date.parse(i.resetAt):null;return m!==null&&(K!==null&&K<=0||N!==null&&!Number.isNaN(N)&&Date.now()>=N)?0:s===null?null:Math.max(0,Math.min(100,s))},ie=i=>{const s=se(i);return s===null?"bg-gradient-to-r from-gray-300 to-gray-400":s>=90?"bg-gradient-to-r from-red-500 to-red-600":s>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},de=i=>{const s=se(i);return s===null?"0%":`${s}%`},te=i=>{const s=se(i);return s===null?"--":`${s.toFixed(1)}%`},Z=i=>{if(!i)return"--";let s=i.remainingSeconds;if(s==null&&(s=i.resetAfterSeconds),s==null||Number.isNaN(Number(s)))return"--";s=Math.max(0,Math.floor(Number(s)));const m=Math.floor(s/86400),K=Math.floor(s%86400/3600),N=Math.floor(s%3600/60),z=s%60;return m>0?K>0?`${m}天${K}小时`:`${m}天`:K>0?N>0?`${K}小时${N}分钟`:`${K}小时`:N>0?`${N}分钟`:`${z}秒`},V=i=>i==="secondary"?"周限":"5h";return(i,s)=>(a(),r("div",jt,[e("div",Dt,[e("div",qt,[e("header",Ut,[e("i",{class:M(["header-icon",t(p)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),e("h3",Et,n(t(p)?"批量查询概要":"API Key 信息"),1)]),t(p)&&t(w)?(a(),r("div",Nt,[e("div",Ot,[s[1]||(s[1]=e("p",{class:"info-label"},"查询 Keys 数",-1)),e("p",Ft,n(t(w).totalKeys)+" 个",1)]),e("div",Wt,[s[3]||(s[3]=e("p",{class:"info-label"},"有效 Keys 数",-1)),e("p",zt,[s[2]||(s[2]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),b(n(t(w).activeKeys)+" 个 ",1)])]),t(I).length>0?(a(),r("div",Vt,[s[5]||(s[5]=e("p",{class:"info-label"},"无效 Keys 数",-1)),e("p",Bt,[s[4]||(s[4]=e("i",{class:"fas fa-times-circle mr-1"},null,-1)),b(n(t(I).length)+" 个 ",1)])])):v("",!0),e("div",Gt,[s[6]||(s[6]=e("p",{class:"info-label"},"总请求数",-1)),e("p",Ht,n(t(O)(t(w).usage.requests)),1)]),e("div",Jt,[s[7]||(s[7]=e("p",{class:"info-label"},"总 Token 数",-1)),e("p",Yt,n(t(O)(t(w).usage.allTokens)),1)]),e("div",Qt,[s[8]||(s[8]=e("p",{class:"info-label"},"总费用",-1)),e("p",Xt,n(t(w).usage.formattedCost),1)]),t(k).length>1?(a(),r("div",Zt,[s[9]||(s[9]=e("p",{class:"info-label"},"Top 3 贡献占比",-1)),e("div",es,[(a(!0),r(X,null,ae(R.value,m=>(a(),r("div",{key:m.apiId,class:"contributor-item"},[e("span",ts,n(m.name),1),e("span",ss,n(u(m))+"%",1)]))),128))])])):v("",!0)])):(a(),r("div",as,[e("div",{class:"info-item cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50",title:"点击复制",onClick:s[0]||(s[0]=m=>t(Ve)(t(o).name))},[s[11]||(s[11]=e("p",{class:"info-label"},"名称",-1)),e("p",rs,[b(n(t(o).name)+" ",1),s[10]||(s[10]=e("i",{class:"fas fa-copy text-xs text-gray-400"},null,-1))])]),e("div",ls,[s[12]||(s[12]=e("p",{class:"info-label"},"状态",-1)),e("p",{class:M(["info-value font-semibold",t(o).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[e("i",{class:M(["mr-1",t(o).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),b(" "+n(t(o).isActive?"活跃":"已停用"),1)],2)]),e("div",ns,[s[13]||(s[13]=e("p",{class:"info-label"},"权限",-1)),e("p",os,n(l(t(o).permissions)),1)]),$.value?(a(),r("div",is,[s[14]||(s[14]=e("p",{class:"info-label"},"服务倍率",-1)),e("div",ds,[(a(!0),r(X,null,ae(t(o).serviceRates,(m,K)=>(a(),r("span",{key:K,class:"inline-flex items-center rounded-full bg-purple-100 px-2.5 py-0.5 text-xs font-medium text-purple-800 dark:bg-purple-900/30 dark:text-purple-300"},n(K)+": "+n(m)+"x ",1))),128))])])):v("",!0),e("div",us,[s[15]||(s[15]=e("p",{class:"info-label"},"创建时间",-1)),e("p",cs,n(t(at)(t(o).createdAt)),1)]),e("div",ms,[s[20]||(s[20]=e("p",{class:"info-label"},"过期时间",-1)),e("div",gs,[t(o).expirationMode==="activation"&&!t(o).isActivated?(a(),r(X,{key:0},[s[16]||(s[16]=e("span",{class:"text-amber-600 dark:text-amber-400"},[e("i",{class:"fas fa-pause-circle mr-1"}),b("未激活 ")],-1)),e("span",xs," 首次使用后 "+n(t(o).activationDays||(t(o).activationUnit==="hours"?24:30))+" "+n(t(o).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):t(o).expiresAt?(a(),r(X,{key:1},[f(t(o).expiresAt)?(a(),r("span",ys,s[17]||(s[17]=[e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),b("已过期 ",-1)]))):c(t(o).expiresAt)?(a(),r("span",fs,[s[18]||(s[18]=e("i",{class:"fas fa-clock mr-1"},null,-1)),b(n(x(t(o).expiresAt)),1)])):(a(),r("span",ps,n(x(t(o).expiresAt)),1))],64)):(a(),r("span",vs,s[19]||(s[19]=[e("i",{class:"fas fa-infinity mr-1"},null,-1),b("永不过期 ",-1)])))])])]))]),e("div",bs,[e("header",ks,[s[21]||(s[21]=e("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),s[22]||(s[22]=e("h3",{class:"header-title"},"使用统计概览",-1)),e("span",hs,n(t(_)==="daily"?"今日":"本月"),1)]),e("div",_s,[e("div",ws,[e("p",$s,n(t(O)(t(g).requests)),1),e("p",Cs,n(t(_)==="daily"?"今日":"本月")+"请求数",1)]),e("div",Ts,[e("p",Ss,n(t(O)(t(g).allTokens)),1),e("p",As,n(t(_)==="daily"?"今日":"本月")+"Token 数",1)]),e("div",Ks,[e("p",Is,n(t(g).formattedCost||"$0.000000"),1),e("p",Ps,n(t(_)==="daily"?"今日":"本月")+"费用",1)]),e("div",Ms,[e("p",Rs,n(t(O)(t(g).inputTokens)),1),e("p",Ls,n(t(_)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!t(p)&&C.value.length>0?(a(),r("div",js,[s[24]||(s[24]=e("header",{class:"section-header"},[e("i",{class:"header-icon fas fa-plug text-indigo-500"}),e("h3",{class:"header-title"},"专属账号运行状态"),e("span",{class:"header-tag"},"实时更新")],-1)),e("div",{class:M(["grid grid-cols-1 gap-4",P.value])},[(a(!0),r(X,null,ae(C.value,m=>{var K,N,z,ce,ye,re;return a(),r("div",{key:m.id||m.key,class:"account-card"},[e("div",Ds,[e("div",qs,[e("span",{class:M(["account-icon",m.platform==="claude"?"icon-claude":"icon-openai"])},[e("i",{class:M(m.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),e("div",null,[e("p",Us,n(D(m)),1),e("p",Es,n(m.platform==="claude"?"会话窗口":"额度窗口"),1)])]),F(m.rateLimitStatus)?(a(),r("div",{key:0,class:M(["rate-badge",F(m.rateLimitStatus).class])},[s[23]||(s[23]=e("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),b(" "+n(F(m.rateLimitStatus).text),1)],2)):v("",!0)]),m.platform==="claude"?(a(),r("div",Ns,[e("div",Os,[e("div",Fs,[e("div",{class:M(["progress-bar",J((K=m.sessionWindow)==null?void 0:K.sessionWindowStatus,m)]),style:ke({width:`${Math.min(100,Math.max(0,((N=m.sessionWindow)==null?void 0:N.progress)||0))}%`})},null,6)]),e("span",Ws,n(Math.min(100,Math.max(0,Math.round(((z=m.sessionWindow)==null?void 0:z.progress)||0))))+"% ",1)]),e("div",zs,[e("span",null,n(Q((ce=m.sessionWindow)==null?void 0:ce.windowStart,(ye=m.sessionWindow)==null?void 0:ye.windowEnd)),1),((re=m.sessionWindow)==null?void 0:re.remainingTime)>0?(a(),r("span",Vs," 剩余 "+n(W(m.sessionWindow.remainingTime)),1)):v("",!0)])])):m.platform==="openai"?(a(),r("div",Bs,[m.codexUsage?(a(),r("div",Gs,[(a(),r(X,null,ae(["primary","secondary"],Y=>{var le,fe,me,be;return e("div",{key:`${m.key}-${Y}`,class:"quota-row"},[e("div",Hs,[e("span",{class:M(["quota-tag",Y==="primary"?"tag-indigo":"tag-blue"])},n(V(Y)),3),e("span",Js,n(te((le=m.codexUsage)==null?void 0:le[Y])),1)]),e("div",Ys,[e("div",{class:M(["progress-bar",ie((fe=m.codexUsage)==null?void 0:fe[Y])]),style:ke({width:de((me=m.codexUsage)==null?void 0:me[Y])})},null,6)]),e("div",Qs," 重置剩余 "+n(Z((be=m.codexUsage)==null?void 0:be[Y])),1)])}),64))])):(a(),r("p",Xs," 暂无额度使用数据 "))])):v("",!0)])}),128))],2)])):v("",!0)]))}},ea=ue(Zs,[["__scopeId","data-v-99d8ab54"]]),ta={class:"card p-3 sm:p-4 md:p-6"},sa={class:"mb-2 flex flex-col text-base font-bold text-gray-900 dark:text-gray-100 sm:mb-3 sm:flex-row sm:items-center sm:text-lg md:mb-4 md:text-xl"},aa={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},ra={class:"space-y-2 md:space-y-3"},la={class:"flex items-center justify-between"},na={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},oa={class:"flex items-center justify-between"},ia={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},da={class:"flex items-center justify-between"},ua={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},ca={class:"flex items-center justify-between"},ma={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},ga={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},xa={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},ya={class:"text-sm md:text-base"},fa={class:"text-lg md:text-xl"},pa={__name:"TokenDistribution",setup(U){const A=xe(),{statsPeriod:o,currentPeriodData:_}=ge(A);return(g,p)=>(a(),r("div",ta,[e("h3",sa,[p[0]||(p[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),b(" Token 使用分布 ")],-1)),e("span",aa,"("+n(t(o)==="daily"?"今日":"本月")+")",1)]),e("div",ra,[e("div",la,[p[1]||(p[1]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),b(" 输入 Token ")],-1)),e("span",na,n(t(O)(t(_).inputTokens)),1)]),e("div",oa,[p[2]||(p[2]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),b(" 输出 Token ")],-1)),e("span",ia,n(t(O)(t(_).outputTokens)),1)]),e("div",da,[p[3]||(p[3]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),b(" 缓存创建 Token ")],-1)),e("span",ua,n(t(O)(t(_).cacheCreateTokens)),1)]),e("div",ca,[p[4]||(p[4]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),b(" 缓存读取 Token ")],-1)),e("span",ma,n(t(O)(t(_).cacheReadTokens)),1)])]),e("div",ga,[e("div",xa,[e("span",ya,n(t(o)==="daily"?"今日":"本月")+"总计",1),e("span",fa,n(t(O)(t(_).allTokens)),1)])])]))}},va=ue(pa,[["__scopeId","data-v-f3f6aa17"]]),ba={class:"flex h-full flex-col gap-3 sm:gap-4 md:gap-6"},ka={class:"card flex h-full flex-col p-3 sm:p-4 md:p-6"},ha={class:"mb-2 flex items-center text-base font-bold text-gray-900 dark:text-gray-100 sm:mb-3 sm:text-lg md:mb-4 md:text-xl"},_a={key:0,class:"space-y-4"},wa={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},$a={class:"mb-3 flex items-center justify-between"},Ca={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Ta={class:"grid grid-cols-2 gap-3"},Sa={class:"text-center"},Aa={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Ka={class:"text-center"},Ia={class:"text-lg font-bold text-green-600"},Pa={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Ma={class:"space-y-2"},Ra={class:"flex items-center justify-between"},La={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ja={class:"flex items-center justify-between"},Da={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},qa={class:"flex items-center justify-between"},Ua={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ea={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},Na={class:"text-red-700 dark:text-red-300"},Oa={key:1,class:"space-y-4 md:space-y-5"},Fa={class:"mb-2 flex items-center justify-between"},Wa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},za={key:0},Va={key:1,class:"flex items-center gap-1"},Ba={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Ga={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Ha={class:"mb-2 flex items-center justify-between"},Ja={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Ya={key:0},Qa={key:1,class:"flex items-center gap-1"},Xa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Za={key:1,class:"h-2 w-full rounded-full bg-gray-200"},er={key:0},tr={class:"mb-2 flex items-center justify-between"},sr={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ar={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},rr={key:1},lr={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},nr={key:0},or={key:1},ir={key:2},dr={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},ur={class:"flex items-center justify-between"},cr={class:"text-sm font-medium text-gray-900 md:text-base"},mr={key:0},gr={key:1,class:"flex items-center gap-1"},xr={class:"flex items-center justify-between"},yr={class:"text-sm font-medium text-gray-900 md:text-base"},fr={key:0,class:"text-orange-600"},pr={key:1,class:"text-green-600"},vr={class:"space-y-2"},br={class:"flex items-center justify-between"},kr={class:"text-sm font-medium text-gray-900 md:text-base"},hr={key:0,class:"text-orange-600"},_r={key:1,class:"text-green-600"},wr={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},$r={key:0,class:"card !overflow-visible p-4 md:p-6"},Cr={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Tr={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},Sr={class:"break-all text-gray-800 dark:text-gray-200"},Ar={__name:"LimitConfig",setup(U){const A=xe(),{statsData:o,multiKeyMode:_,aggregatedStats:g,invalidKeys:p}=ge(A),w=L(()=>{var l;const c=(l=o.value)==null?void 0:l.restrictions;return c?c.enableModelRestriction===!0&&Array.isArray(c.restrictedModels)&&c.restrictedModels.length>0:!1}),k=L(()=>{var l;const c=(l=o.value)==null?void 0:l.restrictions;return c?c.enableClientRestriction===!0&&Array.isArray(c.allowedClients)&&c.allowedClients.length>0:!1}),I=()=>{if(!o.value.limits.dailyCostLimit||o.value.limits.dailyCostLimit===0)return 0;const c=o.value.limits.currentDailyCost/o.value.limits.dailyCostLimit*100;return Math.min(c,100)},R=()=>{const c=I();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-green-500"},$=()=>{if(!o.value.limits.totalCostLimit||o.value.limits.totalCostLimit===0)return 0;const c=o.value.limits.currentTotalCost/o.value.limits.totalCostLimit*100;return Math.min(c,100)},u=()=>{const c=$();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-blue-500"},x=()=>{if(!o.value.limits.weeklyOpusCostLimit||o.value.limits.weeklyOpusCostLimit===0)return 0;const c=o.value.limits.weeklyOpusCost/o.value.limits.weeklyOpusCostLimit*100;return Math.min(c,100)},f=()=>{const c=x();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-indigo-500"};return(c,l)=>{var C;return a(),r("div",ba,[e("div",ka,[e("h3",ha,[l[0]||(l[0]=e("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),b(" "+n(t(_)?"限制配置（聚合查询模式）":"限制配置"),1)]),t(_)&&t(g)?(a(),r("div",_a,[e("div",wa,[e("div",$a,[l[1]||(l[1]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),b(" API Keys 概况 ")],-1)),e("span",Ca,n(t(g).activeKeys)+"/"+n(t(g).totalKeys),1)]),e("div",Ta,[e("div",Sa,[e("div",Aa,n(t(g).totalKeys),1),l[2]||(l[2]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),e("div",Ka,[e("div",Ia,n(t(g).activeKeys),1),l[3]||(l[3]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),e("div",Pa,[l[7]||(l[7]=e("div",{class:"mb-3 flex items-center"},[e("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),e("div",Ma,[e("div",Ra,[l[4]||(l[4]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-database mr-1 text-gray-400"}),b(" 总请求数 ")],-1)),e("span",La,n(t(O)(t(g).usage.requests)),1)]),e("div",ja,[l[5]||(l[5]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-coins mr-1 text-yellow-500"}),b(" 总 Tokens ")],-1)),e("span",Da,n(t(O)(t(g).usage.allTokens)),1)]),e("div",qa,[l[6]||(l[6]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),b(" 总费用 ")],-1)),e("span",Ua,n(t(g).usage.formattedCost),1)])])]),t(p)&&t(p).length>0?(a(),r("div",Ea,[l[8]||(l[8]=e("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),e("span",Na,n(t(p).length)+" 个无效的 API Key ",1)])):v("",!0),l[9]||(l[9]=e("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[e("i",{class:"fas fa-info-circle mr-1"}),b(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):v("",!0),!t(_)&&((C=t(o))!=null&&C.limits)?(a(),r("div",Oa,[e("div",null,[e("div",Fa,[l[11]||(l[11]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),e("span",Wa,[t(o).limits.dailyCostLimit>0?(a(),r("span",za," $"+n(t(o).limits.currentDailyCost.toFixed(4))+" / $"+n(t(o).limits.dailyCostLimit.toFixed(2)),1)):(a(),r("span",Va,[b(" $"+n(t(o).limits.currentDailyCost.toFixed(4))+" / ",1),l[10]||(l[10]=e("i",{class:"fas fa-infinity"},null,-1))]))])]),t(o).limits.dailyCostLimit>0?(a(),r("div",Ba,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",R()]),style:ke({width:I()+"%"})},null,6)])):(a(),r("div",Ga,l[12]||(l[12]=[e("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),e("div",null,[e("div",Ha,[l[14]||(l[14]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),e("span",Ja,[t(o).limits.totalCostLimit>0?(a(),r("span",Ya," $"+n(t(o).limits.currentTotalCost.toFixed(4))+" / $"+n(t(o).limits.totalCostLimit.toFixed(2)),1)):(a(),r("span",Qa,[b(" $"+n(t(o).limits.currentTotalCost.toFixed(4))+" / ",1),l[13]||(l[13]=e("i",{class:"fas fa-infinity"},null,-1))]))])]),t(o).limits.totalCostLimit>0?(a(),r("div",Xa,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",u()]),style:ke({width:$()+"%"})},null,6)])):(a(),r("div",Za,l[15]||(l[15]=[e("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),t(o).limits.weeklyOpusCostLimit>0?(a(),r("div",er,[e("div",tr,[l[16]||(l[16]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Claude 模型周费用限制",-1)),e("span",sr," $"+n(t(o).limits.weeklyOpusCost.toFixed(4))+" / $"+n(t(o).limits.weeklyOpusCostLimit.toFixed(2)),1)]),e("div",ar,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",f()]),style:ke({width:x()+"%"})},null,6)])])):v("",!0),t(o).limits.rateLimitWindow>0&&(t(o).limits.rateLimitRequests>0||t(o).limits.tokenLimit>0||t(o).limits.rateLimitCost>0)?(a(),r("div",rr,[ee(mt,{"cost-limit":t(o).limits.rateLimitCost,"current-cost":t(o).limits.currentWindowCost,"current-requests":t(o).limits.currentWindowRequests,"current-tokens":t(o).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":t(o).limits.rateLimitWindow,"request-limit":t(o).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":t(o).limits.tokenLimit,"window-end-time":t(o).limits.windowEndTime,"window-remaining-seconds":t(o).limits.windowRemainingSeconds,"window-start-time":t(o).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),e("div",lr,[l[17]||(l[17]=e("i",{class:"fas fa-info-circle mr-1"},null,-1)),t(o).limits.rateLimitCost>0?(a(),r("span",nr,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):t(o).limits.tokenLimit>0?(a(),r("span",or,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(a(),r("span",ir," 仅限制请求次数 "))])])):v("",!0),e("div",dr,[e("div",ur,[l[19]||(l[19]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),e("span",cr,[t(o).limits.concurrencyLimit>0?(a(),r("span",mr,n(t(o).limits.concurrencyLimit),1)):(a(),r("span",gr,l[18]||(l[18]=[e("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),e("div",xr,[l[22]||(l[22]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),e("span",yr,[w.value?(a(),r("span",fr,[l[20]||(l[20]=e("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限制 "+n(t(o).restrictions.restrictedModels.length)+" 个模型 ",1)])):(a(),r("span",pr,l[21]||(l[21]=[e("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有模型 ",-1)])))])]),e("div",vr,[e("div",br,[l[25]||(l[25]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),e("span",kr,[k.value?(a(),r("span",hr,[l[23]||(l[23]=e("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限 "+n(t(o).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(a(),r("span",_r,l[24]||(l[24]=[e("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有客户端 ",-1)])))])]),k.value?(a(),r("div",wr,[(a(!0),r(X,null,ae(t(o).restrictions.allowedClients,P=>(a(),r("span",{key:P,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-gray-800 dark:text-blue-300 md:text-sm"},[l[26]||(l[26]=e("i",{class:"fas fa-id-badge"},null,-1)),b(" "+n(P),1)]))),128))])):v("",!0)])])])):v("",!0)]),w.value?(a(),r("div",$r,[l[30]||(l[30]=e("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[e("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),b(" 详细限制信息 ")],-1)),e("div",Cr,[l[28]||(l[28]=e("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[e("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),b(" 受限模型列表 ")],-1)),e("div",Tr,[(a(!0),r(X,null,ae(t(o).restrictions.restrictedModels,P=>(a(),r("div",{key:P,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[l[27]||(l[27]=e("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),e("span",Sr,n(P),1)]))),128))]),l[29]||(l[29]=e("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[e("i",{class:"fas fa-info-circle mr-1"}),b(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):v("",!0)])}}},Kr=ue(Ar,[["__scopeId","data-v-e03e5fe5"]]),Ir={class:"card h-full p-4 md:p-6"},Pr={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Mr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Rr={key:0,class:"space-y-2 md:space-y-3"},Lr={class:"mb-1 flex items-center justify-between text-sm"},jr={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Dr={class:"text-xs text-gray-600 dark:text-gray-400"},qr={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Ur={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},Er={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},Nr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},Or={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},Fr={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},Wr={__name:"AggregatedStatsCard",setup(U){const A=xe(),{aggregatedStats:o,individualStats:_,statsPeriod:g,multiKeyMode:p}=ge(A),w=x=>x?g.value==="daily"?x.dailyUsage||x.usage:x.monthlyUsage||x.usage:null,k=L(()=>!_.value||_.value.length===0?[]:[..._.value].sort((x,f)=>{const c=w(x),l=w(f);return((l==null?void 0:l.cost)||0)-((c==null?void 0:c.cost)||0)}).slice(0,5)),I=L(()=>_.value?Math.max(0,_.value.length-5):0),R=L(()=>{var l,C;if(!_.value||!o.value)return 0;const x=k.value.reduce((P,D)=>{const E=w(D);return P+((E==null?void 0:E.cost)||0)},0),f=g.value==="daily"?((l=o.value.dailyUsage)==null?void 0:l.cost)||0:((C=o.value.monthlyUsage)==null?void 0:C.cost)||0;if(f===0)return 0;const c=f-x;return Math.max(0,Math.round(c/f*100))}),$=x=>{var C,P;if(!o.value)return 0;const f=g.value==="daily"?((C=o.value.dailyUsage)==null?void 0:C.cost)||0:((P=o.value.monthlyUsage)==null?void 0:P.cost)||0;if(f===0)return 0;const c=w(x),l=((c==null?void 0:c.cost)||0)/f*100;return Math.round(l)},u=x=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][x]||"bg-gray-400";return(x,f)=>(a(),r("div",Ir,[e("h3",Pr,[f[0]||(f[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),b(" 使用占比 ")],-1)),e("span",Mr,"("+n(t(g)==="daily"?"今日":"本月")+")",1)]),t(o)&&t(_).length>0?(a(),r("div",Rr,[(a(!0),r(X,null,ae(k.value,(c,l)=>{var C,P;return a(),r("div",{key:c.apiId,class:"relative"},[e("div",Lr,[e("span",jr,n(c.name||`Key ${l+1}`),1),e("span",Dr,n($(c))+"% ",1)]),e("div",qr,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",u(l)]),style:ke({width:$(c)+"%"})},null,6)]),e("div",Ur,[e("span",null,n(t(O)(((C=w(c))==null?void 0:C.requests)||0))+"次",1),e("span",null,n(((P=w(c))==null?void 0:P.formattedCost)||"$0.00"),1)])])}),128)),I.value>0?(a(),r("div",Er,[e("div",Nr,[e("span",null,"其他 "+n(I.value)+" 个Keys",1),e("span",null,n(R.value)+"%",1)])])):v("",!0)])):t(p)?(a(),r("div",Fr,f[2]||(f[2]=[e("i",{class:"fas fa-chart-pie mr-2"},null,-1),b(" 暂无数据 ",-1)]))):(a(),r("div",Or,f[1]||(f[1]=[e("div",{class:"text-center"},[e("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),e("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},zr=ue(Wr,[["__scopeId","data-v-37821008"]]),Vr={class:"card p-3 sm:p-4 md:p-6"},Br={class:"mb-2 sm:mb-3 md:mb-4"},Gr={class:"flex flex-col text-base font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center sm:text-lg md:text-xl"},Hr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Jr={key:0,class:"py-6 text-center md:py-8"},Yr={key:1,class:"space-y-2"},Qr={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between"},Xr={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-3"},Zr=["onClick"],el={class:"flex flex-wrap gap-x-2 text-xs text-gray-500 dark:text-gray-400"},tl={key:0},sl={key:1},al={class:"flex-shrink-0 text-xs sm:text-sm"},rl={class:"ml-1 font-semibold text-green-600"},ll={class:"ml-1 font-semibold text-amber-600 dark:text-amber-400"},nl={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},ol={class:"text-sm md:text-base"},il={__name:"ModelUsageStats",props:{period:{type:String,default:"daily",validator:U=>["daily","monthly","alltime"].includes(U)}},setup(U){const A=U,o=xe(),{dailyModelStats:_,monthlyModelStats:g,alltimeModelStats:p,modelStatsLoading:w,serviceRates:k}=ge(o),I=L(()=>A.period==="daily"?_.value:A.period==="monthly"?g.value:A.period==="alltime"?p.value:[]),R=L(()=>w.value),$=L(()=>A.period==="daily"?"今日":A.period==="monthly"?"本月":A.period==="alltime"?"所有时间":""),u=c=>Ve(c,"模型名称已复制"),x=c=>{if(!c)return"claude";const l=c.toLowerCase();return l.includes("claude")||l.includes("sonnet")||l.includes("opus")||l.includes("haiku")?"claude":l.includes("gpt")||l.includes("o1")||l.includes("o3")||l.includes("o4")?"codex":l.includes("gemini")?"gemini":l.includes("droid")||l.includes("factory")?"droid":l.includes("bedrock")||l.includes("amazon")?"bedrock":l.includes("azure")?"azure":"claude"},f=c=>{var E,F,Q;if(!c.isLegacy&&((E=c.costs)==null?void 0:E.rated)!==void 0){const W=c.costs.rated;return W>=1?"$"+W.toFixed(2):W>=.01?"$"+W.toFixed(4):"$"+W.toFixed(6)}const l=((F=c.costs)==null?void 0:F.total)||0;if(!l||!((Q=k.value)!=null&&Q.rates))return"$0.00";const C=x(c.model),P=k.value.rates[C]||1,D=l*P;return D>=1?"$"+D.toFixed(2):D>=.01?"$"+D.toFixed(4):"$"+D.toFixed(6)};return(c,l)=>(a(),r("div",Vr,[e("div",Br,[e("h3",Gr,[l[0]||(l[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),b(" 模型使用统计 ")],-1)),e("span",Hr,"("+n($.value)+")",1)])]),R.value?(a(),r("div",Jr,l[1]||(l[1]=[e("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):I.value.length>0?(a(),r("div",Yr,[(a(!0),r(X,null,ae(I.value,(C,P)=>{var D,E;return a(),r("div",{key:P,class:"model-usage-item"},[e("div",Qr,[e("div",Xr,[e("h4",{class:"cursor-pointer text-sm font-bold text-gray-900 hover:text-indigo-600 dark:text-gray-100 dark:hover:text-indigo-400",title:"点击复制",onClick:F=>u(C.model)},[b(n(C.model)+" ",1),l[2]||(l[2]=e("i",{class:"fas fa-copy ml-1 text-xs text-gray-400"},null,-1))],8,Zr),e("div",el,[e("span",null,n(C.requests)+"次",1),e("span",null,"输入:"+n(t(O)(C.inputTokens)),1),e("span",null,"输出:"+n(t(O)(C.outputTokens)),1),C.cacheCreateTokens?(a(),r("span",tl,"缓存创建:"+n(t(O)(C.cacheCreateTokens)),1)):v("",!0),C.cacheReadTokens?(a(),r("span",sl,"缓存读取:"+n(t(O)(C.cacheReadTokens)),1)):v("",!0)])]),e("div",al,[l[4]||(l[4]=e("span",{class:"text-gray-500"},"官方API",-1)),e("span",rl,n(((D=C.formatted)==null?void 0:D.total)||"$0.00"),1),(E=t(k))!=null&&E.rates?(a(),r(X,{key:0},[l[3]||(l[3]=e("span",{class:"ml-2 text-gray-500"},"计费",-1)),e("span",ll,n(f(C)),1)],64)):v("",!0)])])])}),128))])):(a(),r("div",nl,[l[5]||(l[5]=e("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),e("p",ol,"暂无"+n($.value)+"模型使用数据",1)]))]))}},Ae=ue(il,[["__scopeId","data-v-0571e613"]]),dl={key:0,class:"card p-3 sm:p-4 md:p-6"},ul={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},cl={class:"mb-2 flex items-center justify-between"},ml={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},gl={class:"flex items-center gap-1"},xl={class:"rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",title:"全局倍率"},yl={key:0,class:"rounded-full bg-purple-100 px-2 py-0.5 text-xs font-medium text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",title:"Key倍率"},fl={class:"mb-2 space-y-0.5 text-xs text-gray-600 dark:text-gray-400"},pl={class:"flex justify-between"},vl={class:"text-gray-900 dark:text-gray-200"},bl={class:"flex justify-between"},kl={class:"text-gray-900 dark:text-gray-200"},hl={key:0,class:"flex justify-between"},_l={class:"text-gray-900 dark:text-gray-200"},wl={key:1,class:"flex justify-between"},$l={class:"text-gray-900 dark:text-gray-200"},Cl={class:"mb-2 space-y-0.5 border-t border-gray-200 pt-2 text-xs dark:border-gray-700"},Tl={class:"flex justify-between"},Sl={class:"font-semibold text-green-600 dark:text-green-400"},Al={class:"flex justify-between"},Kl={class:"font-semibold text-amber-600 dark:text-amber-400"},Il={key:0,class:"space-y-0.5 border-t border-gray-200 pt-2 text-xs text-gray-500 dark:border-gray-700 dark:text-gray-500"},Pl={class:"flex justify-between"},Ml={class:"flex justify-between"},Rl={key:0,class:"flex justify-between"},Ll={key:1,class:"flex justify-between"},jl={__name:"ServiceCostCards",setup(U){const A=xe(),{modelStats:o,serviceRates:_,keyServiceRates:g,multiKeyMode:p}=ge(A),w={claude:"Claude",codex:"Codex",gemini:"Gemini",droid:"Droid",bedrock:"Bedrock",azure:"Azure",ccr:"CCR"},k=$=>{if(!$)return"claude";const u=$.toLowerCase();return u.includes("claude")||u.includes("sonnet")||u.includes("opus")||u.includes("haiku")?"claude":u.includes("gpt")||u.includes("o1")||u.includes("o3")||u.includes("o4")?"codex":u.includes("gemini")?"gemini":u.includes("droid")||u.includes("factory")?"droid":u.includes("bedrock")||u.includes("amazon")?"bedrock":u.includes("azure")?"azure":"claude"},I=L(()=>{var u,x;if(!((u=_.value)!=null&&u.rates)||!((x=o.value)!=null&&x.length))return[];const $={};return Object.keys(_.value.rates).forEach(f=>{$[f]={inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,realCost:0,ratedCost:0,pricing:null}}),o.value.forEach(f=>{var l,C,P,D;const c=k(f.model);if($[c]){$[c].inputTokens+=f.inputTokens||0,$[c].outputTokens+=f.outputTokens||0,$[c].cacheCreateTokens+=f.cacheCreateTokens||0,$[c].cacheReadTokens+=f.cacheReadTokens||0;const E=((l=f.costs)==null?void 0:l.real)??((C=f.costs)==null?void 0:C.total)??0;$[c].realCost+=E;const F=_.value.rates[c]||1,Q=p.value?1:((P=g.value)==null?void 0:P[c])??1,W=!f.isLegacy&&((D=f.costs)==null?void 0:D.rated)!==void 0?f.costs.rated:E*F*Q;$[c].ratedCost+=W,!$[c].pricing&&f.pricing&&($[c].pricing=f.pricing)}}),Object.entries($).filter(([,f])=>f.inputTokens>0||f.outputTokens>0||f.cacheCreateTokens>0||f.realCost>0).map(([f,c])=>{var D;const l=_.value.rates[f]||1,C=p.value?1:((D=g.value)==null?void 0:D[f])??1,P=c.pricing;return{name:f,label:w[f]||f,globalRate:l,keyRate:C,inputTokens:c.inputTokens,outputTokens:c.outputTokens,cacheCreateTokens:c.cacheCreateTokens,cacheReadTokens:c.cacheReadTokens,officialCost:R(c.realCost),ccCost:R(c.ratedCost),pricing:P?{input:R(P.input),output:R(P.output),cacheCreate:P.cacheCreate?R(P.cacheCreate):null,cacheRead:P.cacheRead?R(P.cacheRead):null}:null}}).sort((f,c)=>c.inputTokens+c.outputTokens-(f.inputTokens+f.outputTokens))}),R=$=>!$||$===0?"$0.00":$>=1?"$"+$.toFixed(2):$>=.01?"$"+$.toFixed(4):"$"+$.toFixed(6);return($,u)=>t(_)&&t(o).length>0?(a(),r("div",dl,[u[10]||(u[10]=e("h3",{class:"mb-2 flex items-center justify-between text-base font-bold text-gray-900 dark:text-gray-100 sm:mb-3 sm:text-lg md:mb-4 md:text-xl"},[e("span",{class:"flex items-center"},[e("i",{class:"fas fa-coins mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),b(" 服务费用统计 ")]),e("span",{class:"text-xs font-normal text-gray-500 dark:text-gray-400"}," 计费 = 官方费用 × 全局倍率 × Key倍率 ")],-1)),e("div",ul,[(a(!0),r(X,null,ae(I.value,x=>(a(),r("div",{key:x.name,class:"rounded-xl border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800/50"},[e("div",cl,[e("span",ml,n(x.label),1),e("div",gl,[e("span",xl," 全局 "+n(x.globalRate)+"x ",1),t(p)?v("",!0):(a(),r("span",yl," Key "+n(x.keyRate)+"x ",1))])]),e("div",fl,[e("div",pl,[u[0]||(u[0]=e("span",null,"输入",-1)),e("span",vl,n(t(O)(x.inputTokens)),1)]),e("div",bl,[u[1]||(u[1]=e("span",null,"输出",-1)),e("span",kl,n(t(O)(x.outputTokens)),1)]),x.cacheCreateTokens?(a(),r("div",hl,[u[2]||(u[2]=e("span",null,"缓存创建",-1)),e("span",_l,n(t(O)(x.cacheCreateTokens)),1)])):v("",!0),x.cacheReadTokens?(a(),r("div",wl,[u[3]||(u[3]=e("span",null,"缓存读取",-1)),e("span",$l,n(t(O)(x.cacheReadTokens)),1)])):v("",!0)]),e("div",Cl,[e("div",Tl,[u[4]||(u[4]=e("span",{class:"text-gray-600 dark:text-gray-400"},"官方API",-1)),e("span",Sl,n(x.officialCost),1)]),e("div",Al,[u[5]||(u[5]=e("span",{class:"text-gray-600 dark:text-gray-400"},"计费费用",-1)),e("span",Kl,n(x.ccCost),1)])]),x.pricing?(a(),r("div",Il,[e("div",Pl,[u[6]||(u[6]=e("span",null,"输入",-1)),e("span",null,n(x.pricing.input)+"/M",1)]),e("div",Ml,[u[7]||(u[7]=e("span",null,"输出",-1)),e("span",null,n(x.pricing.output)+"/M",1)]),x.pricing.cacheCreate?(a(),r("div",Rl,[u[8]||(u[8]=e("span",null,"缓存创建",-1)),e("span",null,n(x.pricing.cacheCreate)+"/M",1)])):v("",!0),x.pricing.cacheRead?(a(),r("div",Ll,[u[9]||(u[9]=e("span",null,"缓存读取",-1)),e("span",null,n(x.pricing.cacheRead)+"/M",1)])):v("",!0)])):v("",!0)]))),128))])])):v("",!0)}},Dl=ue(jl,[["__scopeId","data-v-79d7a9ef"]]),ql={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},Ul={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},El={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Nl={class:"flex items-center gap-3"},Ol={class:"text-xs text-gray-500 dark:text-gray-400"},Fl=["disabled"],Wl={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},zl={class:"mb-4"},Vl={class:"relative"},Bl=["value"],Gl={class:"mb-4 space-y-2"},Hl={class:"flex items-center justify-between text-sm"},Jl={class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},Yl={class:"text-sm"},Ql={class:"mb-1 flex items-center justify-between"},Xl=["value"],Zl={class:"text-right text-xs text-gray-400 dark:text-gray-500"},en={class:"text-sm"},tn={class:"mb-1 flex items-center justify-between"},sn=["value"],an={class:"flex items-center justify-between text-sm"},rn={class:"font-medium text-gray-700 dark:text-gray-300"},ln={class:"mb-4"},nn={class:"flex items-center gap-3"},on={class:"text-xs text-gray-500 dark:text-gray-400"},dn={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},un={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},cn={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},mn={class:"max-h-40 overflow-y-auto p-3"},gn={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},xn={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},yn={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},fn={key:2,class:"text-sm text-red-600 dark:text-red-400"},pn={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},vn={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},bn=["disabled"],kn=["disabled"],hn={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""},serviceType:{type:String,default:"claude",validator:U=>["claude","gemini","openai"].includes(U)}},emits:["close"],setup(U,{emit:A}){const o=U,_=A,g=T("idle"),p=T(""),w=T(""),k=T(0),I=T(null),R=T(null),$=T("claude-sonnet-4-5-20250929"),u=T("hi"),x=T(1e3),f=[{value:100,label:"100"},{value:500,label:"500"},{value:1e3,label:"1000"},{value:2e3,label:"2000"},{value:4096,label:"4096"}],c=T({claude:[],gemini:[],openai:[]}),l=async()=>{try{const i=await rt();i.success&&i.data&&(c.value={claude:i.data.claude||[],gemini:i.data.gemini||[],openai:i.data.openai||[]})}catch(i){console.error("Failed to load models:",i)}},C=L(()=>{const i={claude:{name:"Claude",endpoint:"/api-key/test",defaultModel:"claude-sonnet-4-5-20250929",displayEndpoint:"/api/v1/messages"},gemini:{name:"Gemini",endpoint:"/api-key/test-gemini",defaultModel:"gemini-2.5-pro",displayEndpoint:"/gemini/v1/models/:model:streamGenerateContent"},openai:{name:"OpenAI (Codex)",endpoint:"/api-key/test-openai",defaultModel:"gpt-5",displayEndpoint:"/openai/responses"}};return i[o.serviceType]||i.claude}),P=L(()=>c.value[o.serviceType]||[]);We(()=>{l()});const D=L(()=>o.apiKeyName||"当前 API Key"),E=L(()=>{const i=o.apiKeyValue;return i?i.length<=10?"****":i.substring(0,6)+"****"+i.substring(i.length-4):""}),F=L(()=>{switch(g.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),Q=L(()=>{switch(g.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return w.value||"无法通过 API Key 访问服务";default:return""}}),W=L(()=>{switch(g.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),J=L(()=>{switch(g.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),se=L(()=>{switch(g.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),ie=L(()=>{switch(g.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),de=L(()=>{switch(g.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function te(){if(!o.apiKeyValue)return;g.value="testing",p.value="",w.value="",k.value=0,I.value=Date.now(),R.value&&R.value.abort(),R.value=new AbortController;const i=`${lt.apiPrefix}/apiStats${C.value.endpoint}`;try{const s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:o.apiKeyValue,model:$.value,prompt:u.value,maxTokens:x.value}),signal:R.value.signal});if(!s.ok){const z=await s.json().catch(()=>({}));throw new Error(z.message||z.error||`HTTP ${s.status}`)}const m=s.body.getReader(),K=new TextDecoder;let N=!1;for(;!N;){const{done:z,value:ce}=await m.read();if(z){N=!0;continue}const re=K.decode(ce).split(`
`);for(const Y of re)if(Y.startsWith("data: "))try{const le=JSON.parse(Y.substring(6));Z(le)}catch{}}}catch(s){if(s.name==="AbortError")return;g.value="error",w.value=s.message||"连接失败",k.value=Date.now()-I.value}}function Z(i){switch(i.type){case"test_start":break;case"content":p.value+=i.text;break;case"message_stop":break;case"test_complete":k.value=Date.now()-I.value,i.success?g.value="success":(g.value="error",w.value=i.error||"测试失败");break;case"error":g.value="error",w.value=i.error||"未知错误",k.value=Date.now()-I.value;break}}function V(){g.value!=="testing"&&(R.value&&(R.value.abort(),R.value=null),g.value="idle",p.value="",w.value="",k.value=0,_("close"))}return Pe(()=>o.show,i=>{i&&(g.value="idle",p.value="",w.value="",k.value=0,$.value=C.value.defaultModel,u.value="hi",x.value=1e3)}),Pe(()=>o.serviceType,()=>{$.value=C.value.defaultModel}),ze(()=>{R.value&&R.value.abort()}),(i,s)=>(a(),pe(Re,{to:"body"},[U.show?(a(),r("div",ql,[e("div",{class:"absolute inset-0",onClick:V}),e("div",Ul,[e("div",El,[e("div",Nl,[e("div",{class:M(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",g.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":g.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[e("i",{class:M(["fas",g.value==="idle"?"fa-vial":g.value==="testing"?"fa-spinner fa-spin":g.value==="success"?"fa-check":"fa-times"])},null,2)],2),e("div",null,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),e("p",Ol,n(D.value),1)])]),e("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:g.value==="testing",onClick:V},s[4]||(s[4]=[e("i",{class:"fas fa-times text-sm"},null,-1)]),8,Fl)]),e("div",Wl,[e("div",zl,[s[6]||(s[6]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),e("div",Vl,[e("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:E.value},null,8,Bl),s[5]||(s[5]=e("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[e("i",{class:"fas fa-lock text-xs"})],-1))]),s[7]||(s[7]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),e("div",Gl,[e("div",Hl,[s[9]||(s[9]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点",-1)),e("span",Jl,[s[8]||(s[8]=e("i",{class:"fas fa-link"},null,-1)),b(" "+n(C.value.displayEndpoint),1)])]),e("div",Yl,[e("div",Ql,[s[10]||(s[10]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),ve(e("select",{"onUpdate:modelValue":s[0]||(s[0]=m=>$.value=m),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"},[(a(!0),r(X,null,ae(P.value,m=>(a(),r("option",{key:m.value,value:m.value},n(m.label),9,Xl))),128))],512),[[Ee,$.value]])]),e("div",Zl,n($.value),1)]),e("div",en,[e("div",tn,[s[11]||(s[11]=e("span",{class:"text-gray-500 dark:text-gray-400"},"最大输出 Token",-1)),ve(e("select",{"onUpdate:modelValue":s[1]||(s[1]=m=>x.value=m),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"},[(a(),r(X,null,ae(f,m=>e("option",{key:m.value,value:m.value},n(m.label),9,sn)),64))],512),[[Ee,x.value]])])]),e("div",an,[s[12]||(s[12]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试服务",-1)),e("span",rn,n(C.value.name),1)])]),e("div",ln,[s[13]||(s[13]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 提示词 ",-1)),ve(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=m=>u.value=m),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"输入测试提示词...",rows:"2"},null,512),[[Me,u.value]])]),e("div",{class:M(["mb-4 rounded-xl border p-4 transition-all duration-300",W.value])},[e("div",nn,[e("div",{class:M(["flex h-8 w-8 items-center justify-center rounded-lg",J.value])},[e("i",{class:M(["fas text-sm",se.value,ie.value])},null,2)],2),e("div",null,[e("p",{class:M(["font-medium",de.value])},n(F.value),3),e("p",on,n(Q.value),1)])])],2),g.value!=="idle"?(a(),r("div",dn,[e("div",un,[s[14]||(s[14]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),p.value?(a(),r("span",cn,n(p.value.length)+" 字符 ",1)):v("",!0)]),e("div",mn,[p.value?(a(),r("p",gn,[b(n(p.value)+" ",1),g.value==="testing"?(a(),r("span",xn)):v("",!0)])):g.value==="testing"?(a(),r("p",yn,s[15]||(s[15]=[e("i",{class:"fas fa-circle-notch fa-spin"},null,-1),b(" 等待响应中... ",-1)]))):g.value==="error"&&w.value?(a(),r("p",fn,n(w.value),1)):v("",!0)])])):v("",!0),k.value>0?(a(),r("div",pn,[s[16]||(s[16]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,"耗时 "+n((k.value/1e3).toFixed(2))+" 秒",1)])):v("",!0)]),e("div",vn,[e("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:g.value==="testing",onClick:V}," 关闭 ",8,bn),e("button",{class:M(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",g.value==="testing"||!U.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:g.value==="testing"||!U.apiKeyValue,onClick:te},[e("i",{class:M(["fas",g.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),b(" "+n(g.value==="testing"?"测试中...":g.value==="idle"?"开始测试":"重新测试"),1)],10,kn)])])])):v("",!0)]))}},_n={class:"modal-content relative mx-auto flex max-h-[90vh] w-auto max-w-[90vw] flex-col overflow-hidden rounded-2xl bg-white shadow-2xl dark:bg-gray-800"},wn={class:"flex flex-1 items-center justify-center overflow-auto p-6"},$n=["src"],Cn={__name:"PopupImageModal",props:{show:{type:Boolean,required:!0},imageUrl:{type:String,required:!0}},emits:["close","dont-show-again","error"],setup(U,{emit:A}){const o=A,_=()=>{o("close")},g=()=>{o("dont-show-again")},p=()=>{o("error")};return(w,k)=>(a(),pe(Re,{to:"body"},[U.show?(a(),r("div",{key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4",onClick:Ce(_,["self"])},[e("div",_n,[e("button",{class:"absolute right-4 top-4 z-10 flex h-10 w-10 items-center justify-center rounded-full bg-black/50 text-white backdrop-blur-sm transition-all hover:scale-110 hover:bg-black/70",onClick:_},k[0]||(k[0]=[e("i",{class:"fas fa-times text-lg"},null,-1)])),e("div",wn,[e("img",{alt:"启动弹窗",class:"h-auto max-h-full w-auto max-w-full object-contain",src:U.imageUrl,onError:p},null,40,$n)]),e("div",{class:"border-t border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900"},[e("div",{class:"flex flex-col gap-3 sm:flex-row sm:justify-center"},[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-2.5 font-medium text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 sm:flex-none",onClick:_},k[1]||(k[1]=[e("i",{class:"fas fa-times mr-2"},null,-1),b(" 关闭 ",-1)])),e("button",{class:"flex-1 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-2.5 font-medium text-white shadow-sm transition-all hover:from-blue-600 hover:to-blue-700 sm:flex-none",onClick:g},k[2]||(k[2]=[e("i",{class:"fas fa-ban mr-2"},null,-1),b(" 3天不再弹出 ",-1)]))])])])])):v("",!0)]))}},Tn=ue(Cn,[["__scopeId","data-v-8bbfb0e1"]]),Sn={class:"glass-strong mb-4 rounded-2xl p-3 shadow-xl sm:mb-6 sm:rounded-3xl sm:p-4 md:mb-8 md:p-6"},An={class:"flex flex-col items-center justify-between gap-3 sm:gap-4 md:flex-row"},Kn={class:"flex items-center gap-2 md:gap-4"},In={class:"flex items-center"},Pn={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},Mn={class:"mb-4 sm:mb-6 md:mb-8"},Rn={class:"flex justify-center"},Ln={class:"inline-flex w-full max-w-2xl flex-wrap justify-center gap-1 rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl sm:w-auto sm:flex-nowrap"},jn={key:0,class:"tab-content"},Dn={key:0,class:"mb-4 sm:mb-6 md:mb-8"},qn={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},Un={key:1,class:"fade-in"},En={class:"glass-strong rounded-2xl p-3 shadow-xl sm:rounded-3xl sm:p-4 md:p-6"},Nn={class:"mb-3 border-b border-gray-200 pb-3 dark:border-gray-700 sm:mb-4 sm:pb-4 md:mb-6 md:pb-6"},On={class:"flex flex-col items-start justify-between gap-2 sm:gap-3 md:flex-row md:items-center md:gap-4"},Fn={class:"flex w-full items-center gap-2 md:w-auto"},Wn=["disabled"],zn=["disabled"],Vn=["disabled"],Bn={key:0,class:"relative"},Gn=["disabled","title"],Hn={key:0,class:"absolute right-0 top-full z-50 mt-1 min-w-[140px] overflow-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800"},Jn={class:"mb-4 mt-4 grid grid-cols-1 gap-3 sm:mb-6 sm:mt-6 sm:gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},Yn={class:"space-y-4 sm:space-y-6"},Qn={key:1,class:"tab-content"},Xn={class:"glass-strong rounded-3xl shadow-xl"},Zn={key:2,class:"tab-content"},eo={class:"glass-strong rounded-2xl p-4 shadow-xl sm:rounded-3xl sm:p-6 md:p-8"},to={class:"mb-4 flex gap-2 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},so={key:0},ao={key:0,class:"py-8 text-center"},ro={key:1},lo={class:"mb-6 rounded-xl bg-blue-50 p-4 dark:bg-blue-900/20"},no={class:"text-sm text-blue-700 dark:text-blue-300"},oo={class:"font-medium"},io={class:"space-y-4"},uo=["disabled"],co={key:0,class:"fas fa-spinner fa-spin mr-2"},mo={key:1,class:"fas fa-check-circle mr-2"},go={key:0,class:"mt-6"},xo={class:"flex items-start gap-3"},yo={class:"font-medium"},fo={class:"mt-1 text-sm opacity-90"},po={key:0,class:"mt-2 text-sm"},vo={key:0},bo={class:"font-medium"},ko={key:1},ho={class:"font-medium"},_o={key:1},wo={key:0,class:"py-8 text-center"},$o={key:1},Co={key:0,class:"py-8 text-center"},To={key:1,class:"py-8 text-center"},So={key:2,class:"space-y-3"},Ao={class:"flex items-start justify-between gap-4"},Ko={class:"min-w-0 flex-1"},Io={class:"mb-1 flex items-center gap-2"},Po={key:0,class:"inline-flex items-center rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-700 dark:bg-red-900/30 dark:text-red-300"},Mo={class:"text-sm text-gray-600 dark:text-gray-300"},Ro={key:0},Lo={key:1},jo={key:2},Do={class:"whitespace-nowrap text-right text-xs text-gray-500 dark:text-gray-400"},qo={class:"mb-4 flex items-center gap-3"},Uo={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Eo={class:"mb-4 whitespace-pre-wrap text-sm leading-relaxed text-gray-600 dark:text-gray-300"},No={class:"mb-4 flex cursor-pointer items-center gap-2"},Fe="apiStatsNoticeRead",Ke="popupImageHiddenUntil",Oo={__name:"ApiStatsView",setup(U){const A=Je(),o=xe(),_=nt(),g=T("stats"),p=L(()=>_.isDarkMode),{apiKey:w,apiId:k,loading:I,oemLoading:R,error:$,statsPeriod:u,statsData:x,oemSettings:f,multiKeyMode:c}=ge(o),{queryStats:l,switchPeriod:C,loadStatsWithApiId:P,loadOemSettings:D,loadServiceRates:E,loadApiKeyFromStorage:F,reset:Q}=o,W=T(!1),J=T(!1),se=T("claude"),ie=T(!1),de=T(!1),te=T(!1),Z=T("redeem"),V=T(""),i=T(!1),s=T(null),m=T([]),K=T(!1),N=async()=>{var d;if(!V.value.trim()||!k.value)return;i.value=!0,s.value=null;const h=await ot({apiId:k.value,code:V.value.trim()});if(i.value=!1,h.success){const H=((d=h.data)==null?void 0:d.warnings)||[],ne=H.length>0;s.value={success:!0,message:ne?H.join("；"):"额度卡兑换成功！",data:h.data,hasWarnings:ne},V.value="",Se(ne?"兑换成功（部分截断）":"兑换成功",ne?"warning":"success"),P()}else s.value={success:!1,message:h.error||h.message||"兑换失败"},Se(h.error||h.message||"兑换失败","error")},z=async()=>{var d;if(!k.value)return;K.value=!0;const h=await it(k.value);K.value=!1,h.success&&(m.value=((d=h.data)==null?void 0:d.records)||h.data||[])},ce=()=>{g.value="quota",Z.value==="history"&&z()},ye=()=>{Z.value="history",z()},re=h=>{if(!h)return[];if(Array.isArray(h))return h;if(typeof h=="string"){if(h==="all")return[];try{const d=JSON.parse(h);return Array.isArray(d)?d:[]}catch{return[]}}return[]},Y=L(()=>{var d;const h=re((d=x.value)==null?void 0:d.permissions);return h.length===0?!0:h.includes("claude")}),le=L(()=>{var d;const h=re((d=x.value)==null?void 0:d.permissions);return h.length===0?!0:h.includes("gemini")}),fe=L(()=>{var d;const h=re((d=x.value)==null?void 0:d.permissions);return h.length===0?!0:h.includes("openai")}),me=L(()=>Y.value||le.value||fe.value),be=L(()=>{var H;const h=re((H=x.value)==null?void 0:H.permissions);if(h.length===0)return"全部服务";const d={claude:"Claude",gemini:"Gemini",openai:"OpenAI",droid:"Droid"};return h.map(ne=>d[ne]||ne).join(", ")}),we=()=>{J.value=!J.value},he=(h="claude")=>{se.value=h,J.value=!1,W.value=!0},y=()=>{W.value=!1},S=()=>{ie.value=!1,de.value&&sessionStorage.setItem(Fe,"1")},j=()=>{var d;const h=(d=f.value)==null?void 0:d.apiStatsNotice;h!=null&&h.enabled&&(h!=null&&h.content)&&!sessionStorage.getItem(Fe)&&(ie.value=!0)},B=()=>{var d;if(!((d=f.value)!=null&&d.popupImageData))return;const h=localStorage.getItem(Ke);if(h){const H=parseInt(h,10);if(Date.now()<H)return;localStorage.removeItem(Ke)}te.value=!0},G=()=>{te.value=!1},oe=()=>{const d=Date.now()+2592e5;localStorage.setItem(Ke,d.toString()),te.value=!1,Se("已设置3天内不再弹出","success")},$e=()=>{te.value=!1},Le=h=>{J.value&&!h.target.closest(".relative")&&(J.value=!1)},je=h=>{(h.ctrlKey||h.metaKey)&&h.key==="Enter"&&(!I.value&&w.value.trim()&&l(),h.preventDefault()),h.key==="Escape"&&Q()};return We(async()=>{_.initTheme(),await Promise.all([D(),E()]),j(),B();const h=A.query.apiId,d=A.query.apiKey;if(h&&h.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)){k.value=h;const H=F();H&&(w.value=H),P()}else if(d&&d.length>10)w.value=d;else{const H=F();H&&H.length>10&&(w.value=H,l())}document.addEventListener("keydown",je),document.addEventListener("click",Le)}),ze(()=>{document.removeEventListener("keydown",je),document.removeEventListener("click",Le)}),Pe(w,h=>{h||o.clearData()}),(h,d)=>{var ne,De;const H=Qe("router-link");return a(),r("div",{class:M(["min-h-screen p-2 sm:p-4 md:p-6",p.value?"gradient-bg-dark":"gradient-bg"])},[e("div",Sn,[e("div",An,[ee(ut,{loading:t(R),"logo-src":t(f).siteIconData||t(f).siteIcon,subtitle:g.value==="stats"?"API Key 使用统计":g.value==="quota"?"额度卡":"使用教程",title:t(f).siteName},null,8,["loading","logo-src","subtitle","title"]),e("div",Kn,[e("div",In,[ee(ct,{mode:"dropdown"})]),t(f).ldapEnabled||t(f).showAdminButton!==!1?(a(),r("div",Pn)):v("",!0),t(f).ldapEnabled?(a(),pe(H,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:Te(()=>d[14]||(d[14]=[e("i",{class:"fas fa-user text-sm md:text-base"},null,-1),e("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[14]})):v("",!0),t(f).showAdminButton!==!1?(a(),pe(H,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:Te(()=>d[15]||(d[15]=[e("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),e("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[15]})):v("",!0)])])]),e("div",Mn,[e("div",Rn,[e("div",Ln,[e("button",{class:M(["tab-pill-button",g.value==="stats"?"active":""]),onClick:d[0]||(d[0]=q=>g.value="stats")},d[16]||(d[16]=[e("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),e("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),e("button",{class:M(["tab-pill-button",g.value==="quota"?"active":""]),onClick:ce},d[17]||(d[17]=[e("i",{class:"fas fa-ticket-alt mr-1 md:mr-2"},null,-1),e("span",{class:"text-sm md:text-base"},"额度卡",-1)]),2),e("button",{class:M(["tab-pill-button",g.value==="tutorial"?"active":""]),onClick:d[1]||(d[1]=q=>g.value="tutorial")},d[18]||(d[18]=[e("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),e("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),g.value==="stats"?(a(),r("div",jn,[ee(Lt),t($)?(a(),r("div",Dn,[e("div",qn,[d[19]||(d[19]=e("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),b(" "+n(t($)),1)])])):v("",!0),t(x)?(a(),r("div",Un,[e("div",En,[e("div",Nn,[e("div",On,[d[27]||(d[27]=e("div",{class:"flex items-center gap-2 md:gap-3"},[e("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),e("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),e("div",Fn,[e("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:t(u)==="daily"}]]),disabled:t(I),onClick:d[2]||(d[2]=q=>t(C)("daily"))},d[20]||(d[20]=[e("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),b(" 今日 ",-1)]),10,Wn),e("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:t(u)==="monthly"}]]),disabled:t(I),onClick:d[3]||(d[3]=q=>t(C)("monthly"))},d[21]||(d[21]=[e("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),b(" 本月 ",-1)]),10,zn),e("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:t(u)==="alltime"}]]),disabled:t(I),onClick:d[4]||(d[4]=q=>t(C)("alltime"))},d[22]||(d[22]=[e("i",{class:"fas fa-infinity text-xs md:text-sm"},null,-1),b(" 全部 ",-1)]),10,Vn),t(c)?v("",!0):(a(),r("div",Bn,[e("button",{class:M(["test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",me.value?"":"cursor-not-allowed opacity-50"]),disabled:t(I)||!me.value,title:me.value?"测试 API":`当前 Key 可用服务: ${be.value}`,onClick:we},d[23]||(d[23]=[e("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),b(" 测试 ",-1),e("i",{class:"fas fa-chevron-down ml-1 text-xs"},null,-1)]),10,Gn),J.value?(a(),r("div",Hn,[Y.value?(a(),r("button",{key:0,class:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700",onClick:d[5]||(d[5]=q=>he("claude"))},d[24]||(d[24]=[e("i",{class:"fas fa-robot text-orange-500"},null,-1),b(" Claude ",-1)]))):v("",!0),le.value?(a(),r("button",{key:1,class:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700",onClick:d[6]||(d[6]=q=>he("gemini"))},d[25]||(d[25]=[e("i",{class:"fas fa-gem text-blue-500"},null,-1),b(" Gemini ",-1)]))):v("",!0),fe.value?(a(),r("button",{key:2,class:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700",onClick:d[7]||(d[7]=q=>he("openai"))},d[26]||(d[26]=[e("i",{class:"fas fa-code text-green-500"},null,-1),b(" Codex ",-1)]))):v("",!0)])):v("",!0)]))])])]),ee(ea),e("div",Jn,[ee(va,{class:"h-full"}),t(c)?(a(),pe(zr,{key:0,class:"h-full"})):(a(),pe(Kr,{key:1,class:"h-full"}))]),ee(Dl,{class:"mb-4 sm:mb-6"}),e("div",Yn,[ee(Ae,{period:"daily"}),ee(Ae,{period:"monthly"}),ee(Ae,{period:"alltime"})])])])):v("",!0)])):v("",!0),g.value==="tutorial"?(a(),r("div",Qn,[e("div",Xn,[ee(gt)])])):v("",!0),g.value==="quota"?(a(),r("div",Zn,[e("div",eo,[e("div",to,[e("button",{class:M(["rounded-lg px-4 py-2 text-sm font-medium transition-all",Z.value==="redeem"?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:d[8]||(d[8]=q=>Z.value="redeem")},d[28]||(d[28]=[e("i",{class:"fas fa-ticket-alt mr-2"},null,-1),b(" 兑换额度卡 ",-1)]),2),e("button",{class:M(["rounded-lg px-4 py-2 text-sm font-medium transition-all",Z.value==="history"?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:ye},d[29]||(d[29]=[e("i",{class:"fas fa-history mr-2"},null,-1),b(" 兑换记录 ",-1)]),2)]),Z.value==="redeem"?(a(),r("div",so,[t(k)?(a(),r("div",ro,[e("div",lo,[e("p",no,[d[31]||(d[31]=e("i",{class:"fas fa-info-circle mr-2"},null,-1)),d[32]||(d[32]=b(" 当前 API Key: ",-1)),e("span",oo,n(((ne=t(x))==null?void 0:ne.name)||t(k)),1)])]),e("div",io,[e("div",null,[d[33]||(d[33]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 额度卡卡号 ",-1)),ve(e("input",{"onUpdate:modelValue":d[10]||(d[10]=q=>V.value=q),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 placeholder-gray-400 transition-all focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-500",placeholder:"请输入额度卡卡号",type:"text",onKeyup:Ie(N,["enter"])},null,544),[[Me,V.value]])]),e("button",{class:"w-full rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-3 font-medium text-white transition-all hover:from-green-600 hover:to-emerald-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:!V.value.trim()||i.value,onClick:N},[i.value?(a(),r("i",co)):(a(),r("i",mo)),b(" "+n(i.value?"兑换中...":"立即兑换"),1)],8,uo)]),s.value?(a(),r("div",go,[e("div",{class:M(["rounded-xl p-4",s.value.success?s.value.hasWarnings?"bg-yellow-50 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300"])},[e("div",xo,[e("i",{class:M(["mt-0.5 text-lg",s.value.success?s.value.hasWarnings?"fas fa-exclamation-triangle":"fas fa-check-circle":"fas fa-times-circle"])},null,2),e("div",null,[e("p",yo,n(s.value.success?s.value.hasWarnings?"兑换成功（部分截断）":"兑换成功":"兑换失败"),1),e("p",fo,n(s.value.message),1),s.value.success&&s.value.data?(a(),r("div",po,[s.value.data.quotaAdded?(a(),r("p",vo,[d[34]||(d[34]=b(" 额度增加: ",-1)),e("span",bo,"$"+n(s.value.data.quotaAdded),1)])):v("",!0),s.value.data.timeAdded?(a(),r("p",ko,[d[35]||(d[35]=b(" 有效期延长: ",-1)),e("span",ho,n(s.value.data.timeAdded)+n(s.value.data.timeUnit==="days"?"天":s.value.data.timeUnit==="hours"?"小时":"月"),1)])):v("",!0)])):v("",!0)])])],2)])):v("",!0)])):(a(),r("div",ao,[d[30]||(d[30]=e("div",{class:"mb-4 text-gray-500 dark:text-gray-400"},[e("i",{class:"fas fa-key mb-4 block text-4xl opacity-50"}),e("p",null,"请先在「统计查询」页面输入您的 API Key")],-1)),e("button",{class:"rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-2.5 font-medium text-white transition-all hover:from-blue-600 hover:to-cyan-600",onClick:d[9]||(d[9]=q=>g.value="stats")}," 前往输入 API Key ")]))])):v("",!0),Z.value==="history"?(a(),r("div",_o,[t(k)?(a(),r("div",$o,[K.value?(a(),r("div",Co,d[37]||(d[37]=[e("i",{class:"fas fa-spinner fa-spin text-2xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):m.value.length===0?(a(),r("div",To,d[38]||(d[38]=[e("i",{class:"fas fa-inbox text-4xl text-gray-300 dark:text-gray-600"},null,-1),e("p",{class:"mt-2 text-gray-500 dark:text-gray-400"},"暂无兑换记录",-1)]))):(a(),r("div",So,[(a(!0),r(X,null,ae(m.value,q=>(a(),r("div",{key:q.id,class:"rounded-xl border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800"},[e("div",Ao,[e("div",Ko,[e("div",Io,[e("span",{class:M(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",q.cardType==="quota"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":q.cardType==="time"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"])},n(q.cardType==="quota"?"额度卡":q.cardType==="time"?"时间卡":"组合卡"),3),q.status==="revoked"?(a(),r("span",Po," 已撤销 ")):v("",!0)]),e("p",Mo,[q.quotaAdded?(a(),r("span",Ro,"额度 +$"+n(q.quotaAdded),1)):v("",!0),q.quotaAdded&&q.timeAdded?(a(),r("span",Lo," · ")):v("",!0),q.timeAdded?(a(),r("span",jo,"有效期 +"+n(q.timeAmount)+n(q.timeUnit==="days"?"天":q.timeUnit==="hours"?"小时":"月"),1)):v("",!0)])]),e("div",Do,n(t(dt)(q.redeemedAt)),1)])]))),128))]))])):(a(),r("div",wo,[d[36]||(d[36]=e("div",{class:"mb-4 text-gray-500 dark:text-gray-400"},[e("i",{class:"fas fa-key mb-4 block text-4xl opacity-50"}),e("p",null,"请先在「统计查询」页面输入您的 API Key")],-1)),e("button",{class:"rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-2.5 font-medium text-white transition-all hover:from-blue-600 hover:to-cyan-600",onClick:d[11]||(d[11]=q=>g.value="stats")}," 前往输入 API Key ")]))])):v("",!0)])])):v("",!0),ee(hn,{"api-key-name":((De=t(x))==null?void 0:De.name)||"","api-key-value":t(w),"service-type":se.value,show:W.value,onClose:y},null,8,["api-key-name","api-key-value","service-type","show"]),(a(),pe(Re,{to:"body"},[ee(Ye,{name:"fade"},{default:Te(()=>{var q,qe;return[ie.value?(a(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",onClick:Ce(S,["self"])},[e("div",{class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl dark:bg-gray-800",onClick:d[13]||(d[13]=Ce(()=>{},["stop"]))},[e("div",qo,[d[39]||(d[39]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white"},[e("i",{class:"fas fa-bell"})],-1)),e("h3",Uo,n(((q=t(f).apiStatsNotice)==null?void 0:q.title)||"通知"),1)]),e("p",Eo,n((qe=t(f).apiStatsNotice)==null?void 0:qe.content),1),e("label",No,[ve(e("input",{"onUpdate:modelValue":d[12]||(d[12]=Be=>de.value=Be),class:"h-4 w-4 rounded border-gray-300 text-blue-500 focus:ring-blue-500",type:"checkbox"},null,512),[[Xe,de.value]]),d[40]||(d[40]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"本次会话不再显示",-1))]),e("button",{class:"w-full rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 px-4 py-2.5 font-medium text-white transition-all hover:from-blue-600 hover:to-cyan-600",onClick:S}," 知道了 ")])])):v("",!0)]}),_:1})])),ee(Tn,{"image-url":t(f).popupImageData,show:te.value,onClose:G,onDontShowAgain:oe,onError:$e},null,8,["image-url","show"])],2)}}},Yo=ue(Oo,[["__scopeId","data-v-40d4bf0a"]]);export{Yo as default};
